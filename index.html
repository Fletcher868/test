<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KryptNote | End-to-End Encrypted Notes</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
  <link rel="shortcut icon" href="/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="/favicon/site.webmanifest" />
  <!-- Description (important for SEO) -->
  <meta name="description" content="KryptNote: Secure, end-to-end encrypted note-taking app. Private notes with AES-GCM 256-bit encryption, Zero-knowledge, no tracking, and version history.">
  <!-- Keywords – 2025 optimized for KryptNote -->
  <meta name="keywords" content="encrypted notes, secure notes app, private note taking, end-to-end encrypted notes, e2ee notes, zero knowledge notes, aes-256 notes, offline notes app, open source notes, privacy focused notes, secure notepad, encrypted notepad, version history notes, standard notes alternative, joplin alternative, obsidian alternative, evernote alternative secure">
  <meta name="author" content="KryptNote">

  <style>
    .btn-icon { width:18px; height:18px; margin-right:6px; vertical-align:middle; fill:currentColor; }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sb-head">
        <a href="/" class="logo-link">
          <div class="logo-container">
            <div class="logo-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 4L4 8V16L12 20L20 16V8L12 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 12L8 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M12 12L16 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M8 14L12 16L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="logo-text">
              <span class="logo-name">Krypt</span>
              <span class="logo-subtitle">Note</span>
            </div>
          </div>
        </a>

      </div>
      <div id="filesList" class="files"></div>
      
      <div class="sb-profile">
        <!-- Profile Button with Dots -->
        <button id="profileBtn" class="profile-btn">
          <div class="avatar">U</div>
          <div class="info">
            <div class="name" title="Guest User">Guest User</div>
            <div class="status guest">Guest</div>
          </div>
          <div class="profile-dots">⋯</div>
        </button>
        
        <div id="profileDropdown" class="profile-dropdown hidden">
        
          <!-- === GUEST MENU (Logged Out) === -->
          <div id="menuDefault" class="dropdown-content">
            <div class="menu-section">
              <button id="loginBtn" class="dropdown-item">
                <div class="icon-box"><svg class="btn-icon"><use href="#icon-login"/></svg></div>
                <span>Log in</span>
              </button>
              <button id="signupBtn" class="dropdown-item">
                <div class="icon-box"><svg class="btn-icon"><use href="#icon-user"/></svg></div>
                <span>Sign up</span>
              </button>
            </div>

            <div class="menu-divider"></div>

            <div class="menu-section">
              <button class="dropdown-item dropdown-option">
                <div class="icon-box"><svg class="btn-icon"><use href="#icon-help"/></svg></div>
                <span>Help & Pricing</span>
                <span class="arrow-right">›</span>
                
                <!-- Submenu -->
                <div class="submenu">
                  <a href="Pricing.html" class="dropdown-item">
                    <svg class="btn-icon"><use href="#icon-pricing"/></svg> Pricing
                  </a>
                  <a href="faq.html" class="dropdown-item">
                    <svg class="btn-icon"><use href="#icon-faq"/></svg> FAQ
                  </a>
                  <a href="contact.html" class="dropdown-item">
                    <svg class="btn-icon"><use href="#icon-contact"/></svg> Contact
                  </a>
                </div>
              </button>
            </div>
          </div>

          <!-- === USER MENU (Logged In) === -->
          <div id="menuLoggedIn" class="dropdown-content hidden">
            
            <!-- Section 1: Premium CTA -->
            <div class="menu-section">
              <button id="upgradeBtn" class="dropdown-item upgrade-item" style="display:none;">
                <div class="icon-box special"><svg class="btn-icon"><use href="#icon-crown"/></svg></div>
                <div class="text-col">
                  <span class="item-title">Upgrade to Pro</span>
                </div>
              </button>
            </div>

            <!-- Section 2: Tools -->
            <div class="menu-section">
              <button id="settingsBtn" class="dropdown-item">
                <div class="icon-box"><svg class="btn-icon"><use href="#icon-settings"/></svg></div>
                <span>Settings</span>
              </button>
              <button id="exportAll" class="dropdown-item">
                <div class="icon-box"><svg class="btn-icon"><use href="#icon-export"/></svg></div>
                <span>Export Data</span>
              </button>
            </div>

            <div class="menu-divider"></div>

            <!-- Section 3: Support & Logout -->
            <div class="menu-section">
              <button class="dropdown-item dropdown-option">
                <div class="icon-box"><svg class="btn-icon"><use href="#icon-help"/></svg></div>
                <span>Help & Pricing</span>
                <span class="arrow-right">›</span>
                <div class="submenu">
                  <a href="Pricing.html" class="dropdown-item">
                    <svg class="btn-icon"><use href="#icon-pricing"/></svg> Plans
                  </a>
                  <a href="faq.html" class="dropdown-item">
                    <svg class="btn-icon"><use href="#icon-faq"/></svg> FAQ
                  </a>
                  <a href="contact.html" class="dropdown-item">
                    <svg class="btn-icon"><use href="#icon-contact"/></svg> Contact
                  </a>
                </div>
              </button>
              
              <button id="logoutBtn" class="dropdown-item danger-item">
                <div class="icon-box"><svg class="btn-icon"><use href="#icon-logout"/></svg></div>
                <span>Log out</span>
              </button>
            </div>
          </div>

          <!-- === FORMS (Login / Signup) === -->
          <!-- Login Form -->
          <div id="loginForm" class="dropdown-content form-content hidden">
            <div class="form-header">
              <h4>Welcome back</h4>
              <p>Log in to sync your notes</p>
            </div>
            <div class="input-group">
              <input type="email" id="loginEmail" placeholder="name@example.com" required />
            </div>
            <div class="input-group">
              <input type="password" id="loginPassword" placeholder="Password" required />
            </div>
            <div class="form-actions-stacked">
              <button id="submitLogin" class="btn-primary">Log in</button>
              <button id="backToMenu" class="btn-menu">Cancel</button>
            </div>
          </div>

<!-- Signup Form -->
          <div id="signupForm" class="dropdown-content form-content hidden">
            <div class="form-header">
              <h4>Create Account</h4>
              <p>Start your encrypted notebook</p>
            </div>
            
            <!-- START: E2EE WARNING -->
            <div class="offline-message" style="margin-bottom: 12px;">
              <!-- Lock icon -->
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              <div class="offline-text">
            <strong>Critical Warning:</strong>
            <small>Your notes are end-to-end encrypted.If you lose your password, we cannot recover your account or notes.
</small>

              </div>
            </div>
            <!-- END: E2EE WARNING -->
            
            <div class="input-group">
              <!-- Changed placeholder from "Full Name" to "Username" -->
              <input type="text" id="signupName" placeholder="Username" required />
            </div>
            <div class="input-group">
              <input type="email" id="signupEmail" placeholder="Email" required />
            </div>
            <div class="input-group">
              <!-- Updated placeholder for complexity rule -->
              <input type="password" id="signupPassword" placeholder="Create Password (min 10 chars)" required />
            </div>
            <!-- ADDED CONFIRM PASSWORD FIELD -->
            <div class="input-group">
                <input type="password" id="signupPasswordConfirm" placeholder="Confirm Password" required />
            </div>
            <div class="form-actions-stacked">
              <button id="submitSignup" class="btn-primary">Create Account</button>
              <button id="backToMenuSignup" class="btn-menu">Cancel</button>
            </div>
          </div>

        </div>
      </div>

    </aside>

   <!-- Workspace -->
    <main class="workspace">
      
      <!-- LEFT: Toolbar + Editor (ONE container, full height) -->
      <div class="editor-container">
        
    <!-- TOOLBAR -->
    <div class="toolbar-container">
      <div class="toolbar-slider">
        <!-- Default Panel -->
        <div class="toolbar-panel default-panel">
          <button id="undoBtn" title="Undo">
            <svg class="btn-icon"><use href="#icon-undo"/></svg>
            <span class="btn-text">Undo</span>
          </button>
          <button id="redoBtn" title="Redo">
            <svg class="btn-icon"><use href="#icon-redo"/></svg>
            <span class="btn-text">Redo</span>
          </button>
          <button id="copyBtn" title="Copy">
            <svg class="btn-icon"><use href="#icon-copy"/></svg>
            <span class="btn-text">Copy</span>
          </button>
          <button id="cutBtn" title="Cut">
            <svg class="btn-icon"><use href="#icon-cut"/></svg>
            <span class="btn-text">Cut</span>
          </button>
          <button id="pasteBtn" title="Paste">
            <svg class="btn-icon"><use href="#icon-paste"/></svg>
            <span class="btn-text">Paste</span>
          </button>
          <button id="selectAllBtn" title="Select All">
            <svg class="btn-icon"><use href="#icon-select-all"/></svg>
            <span class="btn-text">Select All</span>
          </button>
          <button id="findDockBtn" class="mode-btn" title="Find">
            <svg class="btn-icon"><use href="#icon-search"/></svg>
            <span class="btn-text">Find</span>
          </button>
          <button id="replaceDockBtn" class="mode-btn" title="Replace">
            <svg class="btn-icon"><use href="#icon-replace"/></svg>
            <span class="btn-text">Replace</span>
          </button>
          
<!-- Tools Dropdown Button -->
<div class="tools-dropdown">
  <button id="toolsMenuBtn" class="tools-btn">
    <svg class="btn-icon"><use href="#icon-tools"/></svg>
    <span class="btn-text">Tools</span>
  </button>
  <div id="toolsDropdown" class="tools-dropdown-content hidden">
    <button id="tool_remove_duplicates" title="Remove Duplicate Lines">
      <svg class="btn-icon"><use href="#icon-clear"/></svg>
      Remove Duplicates
    </button>
    <button id="tool_sort_lines" title="Sort Lines">
      <svg class="btn-icon"><use href="#icon-menu"/></svg>
      Sort Lines
    </button>
<button id="tool_remove_empty_lines" title="Remove Empty Lines">
  <svg class="btn-icon"><use href="#icon-remove-empty"/></svg>
  Remove Empty Lines
</button>
  </div>
</div>
        </div>
      </div>
    </div>

        <!-- Editor + Find Dock -->
        <div class="editor-left">
          <textarea id="textEditor" placeholder="Write or edit your text here..."></textarea>

          <!-- Find/Replace Dock -->
          <div id="findDock" class="find-dock hidden" role="region" aria-label="Find and Replace">
            <div class="find-dock-row">
              <input id="dock_find" type="text" placeholder="Find..." />
              <input id="dock_replace" type="text" placeholder="Replace with..." />
              <label class="dock-checkbox"><input id="dock_regex" type="checkbox" /> Regex</label>
              <button id="dock_find_btn">Find</button>
              <button id="dock_replace_btn">Replace</button>
              <button id="dock_replace_all_btn">Replace All</button>
              <button id="dock_close" class="close-btn" title="Close">X</button>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Sidebar (FULLY INDEPENDENT, FULL HEIGHT) -->
      <aside class="editor-right">
        <div class="sidebar-tabs">
          <button class="tab-btn" data-tab="note-info">Info</button>
          <button class="tab-btn active" data-tab="version-history">History</button>
        </div>

        <div class="sidebar-content">
          <!-- TAB: Note Info -->
          <div id="note-info" class="tab-panel">
            <div class="info-section">
              <h4>Note Details</h4>
              <div class="detail-row">
                <label>Name:</label>
                <span id="infoFileName" class="filename-display"></span>
              </div>
              <div class="detail-row">
                <label>Created:</label>
                <span id="infoCreated">—</span>
              </div>
              <div class="detail-row">
                <label>Modified:</label>
                <span id="infoModified">—</span>
              </div>
            </div>

            <div class="info-section">
              <h4>Encryption</h4>
              <!-- Guest / Offline -->
              <div id="encryptionOffline" class="offline-message">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                  <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
                <div class="offline-text">
                  <strong>You're offline</strong>
                  <small>Sign in to save notes with end-to-end encryption</small>
                </div>
              </div>

              <!-- Logged in -->
              <div id="encryptionOnline" class="encryption-badge">
                <svg class="btn-icon" style="fill:#10b981;"><use href="#icon-lock"/></svg>
                <span>AES-GCM 256-bit (E2E)</span>
              </div>
            </div>

            <div class="info-section">
              <h4>Export</h4>
              <button id="infoDownload" class="outline small">
                <svg class="btn-icon"><use href="#icon-download"/></svg>
                Download Note
              </button>
            </div>
          </div>


         <!-- Version History TAB - Updated sticky bottom -->
<!-- Version History TAB - Updated sticky bottom -->
        <div id="version-history" class="tab-panel active">
          <div class="info-section">
            <h4>Version History</h4>
            <ul id="versionList" class="version-list">
              <!-- Filled by JS -->
            </ul>
          </div>
          <!-- The footer will now be dynamically inserted here by JS -->
        </div>
        </div>
      </aside>

    </main>
  </div>

<!-- Settings Modal (New Professional Design) -->
<div id="settingsModal" class="st-modal hidden">
  <div class="st-card">
    
    <!-- 1. Header: Profile & Close -->
    <div class="st-header">
      <div class="st-user-summary">
        <div id="stAvatar" class="st-avatar-large">U</div>
        <div class="st-user-details">
          <h3 id="stName">User Name</h3>
          <span id="stEmail">user@example.com</span>
        </div>
      </div>
      <button id="closeSettings" class="st-close-btn">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 18L18 6M6 6l12 12"></path></svg>
      </button>
    </div>

    <!-- 2. Tabs Navigation -->
    <div class="st-tabs">
      <button class="st-tab-btn active" data-target="tab-general">General</button>
      <button class="st-tab-btn" data-target="tab-security">Security</button>
      <button class="st-tab-btn" data-target="tab-data">Data</button>
    </div>

    <!-- 3. Content Body -->
    <div class="st-body">
      
      <!-- TAB: General (Plan & Stats) -->
      <div id="tab-general" class="st-tab-content active">
        <!-- Plan Card -->
        <div class="st-section-card" id="stPlanCard">
          <div class="st-row-between">
            <div>
              <div class="st-label">Current Plan</div>
              <div id="stPlanName" class="st-value-large">Free Plan</div>
            </div>
            <div id="stPlanBadge" class="st-badge">Free</div>
          </div>
          <div class="st-divider"></div>
          <div class="st-row-between">
            <span id="stPlanExpiry" class="st-subtext">Unlock all premium features</span>
            <button id="stUpgradeBtn" class="st-btn-primary small">Upgrade to Pro</button>
          </div>
        </div>

        <!-- Stats Grid -->
        <div class="st-grid-2">
          <div class="st-stat-box">
            <span class="st-stat-label">Total Notes</span>
            <span id="stNoteCount" class="st-stat-value">0</span>
          </div>
          <div class="st-stat-box">
            <span class="st-stat-label">Member Since</span>
            <span id="stJoinedDate" class="st-stat-value">—</span>
          </div>
        </div>
      </div>

      <!-- TAB: Security (Password) -->
<div id="tab-security" class="st-tab-content">
    <div class="st-form-group">
        <label class="st-label">Change Password</label>
        <input type="password" id="currentPassword" class="st-input" placeholder="Current password" />
        <!-- Placeholder updated from min 6 chars to min 10 chars -->
        <input type="password" id="newPassword" class="st-input" placeholder="New password (min 10 chars)" />
        <input type="password" id="confirmPassword" class="st-input" placeholder="Confirm new password" />
    </div>
    <div class="st-info-box" style="background:#fff7ed; color:#c2410c; border-color:#fed7aa;">
        <strong>Warning:</strong> We cannot recover your password. If you forget it, your notes will be lost forever.
    </div>
    <div class="st-actions-right">
        <button id="changePasswordBtn" class="st-btn-primary">Update Password</button>
    </div>
</div>

      <!-- TAB: Data (Import/Export/Delete) -->
      <div id="tab-data" class="st-tab-content">
        
        <div class="st-label" style="margin-bottom:12px">Backup & Restore</div>
        
        <!-- Big Clickable Cards Grid -->
        <div class="st-action-grid">
          <button id="exportJsonBtn" class="st-action-card-btn">
            <svg class="btn-icon"><use href="#icon-export"/></svg>
            <span class="st-action-text">Export JSON</span>
          </button>
          
          <button id="importJsonBtn" class="st-action-card-btn">
            <svg class="btn-icon"><use href="#icon-download"/></svg>
            <span class="st-action-text">Import JSON</span>
          </button>
        </div>

        <input type="file" id="importFileInput" accept=".json" hidden />

        <!-- Danger Zone at the bottom -->
        <div class="st-danger-section">
            <div class="st-label" style="color:#ef4444;">Danger Zone</div>
            <div class="st-danger-row">
              <div class="st-danger-info">
                <strong>Delete Account</strong>
                <p>This will erase all notes permanently.</p>
              </div>
              <button id="deleteAccountBtn" class="st-btn-danger">Delete</button>
            </div>
        </div>
      </div>

    </div>
  </div>
</div>

  <!-- Scripts -->
  <!-- icons.js moved to the bottom of body to fix "null" error -->
  <script src="icons.js"></script>
  <script src="crypto.js" type="module"></script>
  <script src="settings.js" type="module"></script>
  <script src="export.js" type="module"></script>  <!-- ADD THIS LINE -->
  <script src="script.js" type="module" defer></script>
</body>
</html>